<!DOCTYPE html>
<!--
  ~    Copyright (c) 2015-2016, EMC Corporation
  ~
  ~ 	Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  ~
  -->

<html
	xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.thymeleaf.org">
<head>

    <script src="../static/js/confirmation.js" th:src="@{/js/confirmation.js}"></script>
</head>

<body>
	<!-- Current Users Table -->
	<div th:fragment="userList" class="row">
	
		<div class="col-sm-12 table-responsive">
			<table class="table table-hover" id="usersListTable">
				<thead>
					<tr>
						<th data-sortable="true" th:text="#{users.management.table.first.name.label}" class="hidden-sm hidden-xs"></th>
						<th th:text="#{users.management.table.last.name.label}" class="hidden-sm hidden-xs"></th>
						<th th:text="#{users.management.table.username.label}"></th>
						<th th:text="#{users.management.table.user.type.label}"></th>
						<th th:text="#{users.management.table.zone.label}" class="hidden-sm hidden-xs"></th>
						<th th:text="#{users.management.table.email.label}" class="hidden-sm hidden-xs"></th>
						<th th:text="#{users.management.table.action.label}"></th>
					</tr>
				</thead>

				<tbody id="fBody">
					<tr th:each="user : ${users}">
						<td th:text="${user.firstName}" class="hidden-sm hidden-xs"></td>
						<td th:text="${user.lastName}" class="hidden-sm hidden-xs"></td>
						<td th:text="${user.username}" class="col-username"></td>
						<td th:text="${user.userType}"></td>
						<td th:text="${user.additionalInfo}" class="col-additional-info hidden-sm hidden-xs"></td>
						<td th:text="${user.email}" class="hidden-sm hidden-xs"></td>
						<td>
							<a class="btn btn-default btn-xs" th:href="@{ ${urlMap.URL_MODIFY_USER} } + ${user.username} + '/' + ${user.additionalInfo} + '/'"
								th:id="${urlMap.URL_MODIFY_USER} + ${user.username} + '/' + ${user.additionalInfo} + '/'">
								<span class="glyphicon glyphicon-pencil"> </span>
							</a>
							&nbsp; &nbsp;
							<button th:id="${'btn_remove_' + user.username}" th:class="${#strings.equalsIgnoreCase(user.username, usernameLogged) ? 'disabled btn btn-default btn-xs' : 'btn btn-default btn-xs'}" type="button" th:onclick="'javascript:confirmUserRemoval(\'' + ${user.username} + '\');'">
								<span class="glyphicon glyphicon-trash"> </span>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<!-- Modal -->
		<div class="modal fade" id="removalModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
					  <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
					  <h4 class="modal-title" id="myModalLabel" th:text="#{confirmation.user.removal.title}">
					  </h4>
					</div>
					<div class="modal-body">
						<span th:text="#{confirmation.user.removal.label}"></span>
						<span id="elementToBeRemoved" style="font-weight: bold;"></span> 
						?
					</div>
					<div class="modal-footer">
					  <button type="button" class="btn btn-default" data-dismiss="modal" id="btnConfUserRemoval_No" 
					  	th:text="#{confirmation.message.no}">
					  </button>
					  <button type="button" class="btn btn-primary" onclick="removeElement();" id="btnConfUserRemoval_Yes"
					  	th:text="#{confirmation.message.yes}">
					  </button>
					</div>
				</div>
			</div>
		</div>

		
	    <!-- <script type="text/javascript" th:src="@{/js/jquery.tablesorter.min.js}"></script> -->
		<!-- User removal confirmation -->
		<script th:inline="javascript">
		/*<![CDATA[*/
			$(document).ready(function(){
				var datatable = $("#usersListTable").DataTable({
					"dom": dtPatternMlxStandard,
	    		    "language": i18n,
					"stateSave": true,
					"autoWidth": false,
	    		    "stateSaveParams": function (settings, data) {
	    		    	data.search.search = "";
	    		    },	    		    
	    		    "initComplete": function(settings){
	    	            $('#usersListTable tbody td').each(function () {
	    	            	$(this).attr('title', $(this).text().trim());
	    	            });
	    	        },
	    	        "drawCallback": function(){
	    	            $(".dataTables_paginate.paging_simple_numbers .pagination").addClass("pagination-sm");
	    	            $('.dataTables_paginate.paging_simple_numbers')
	    	            .css( 'display', this.api().data().length <= 0 ?
	    	                 'none' :
	    	                 'block'
	    	            )
	    	        },
				});
				addGoToPage('usersListTable', datatable);
			});
			function removeElement() {
				var username = $("#elementToBeRemoved").html();
				window.location = [[${urlMap.URL_DELETE_USER}]] + username + "/";
			} 
		
			/* Show dialog to confirm user removal */
	        function confirmUserRemoval(username) {
				$("#elementToBeRemoved").html(username);
				$("#removalModal").modal("show");
			}
	        /*]]>*/
		</script>

	</div>
</body>
</html>